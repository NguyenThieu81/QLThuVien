<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity">
<head th:fragment="header">
  <meta charset="utf-8"/>
  <title>Qu·∫£n l√Ω Th∆∞ Vi·ªán - Online Library</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <style>
    body {
        font-family: 'Roboto', sans-serif;
        display: flex;
        flex-direction: column;
        min-height: 100vh; /* ƒê·∫£m b·∫£o chi·ªÅu cao t·ªëi thi·ªÉu b·∫±ng chi·ªÅu cao c·ªßa c·ª≠a s·ªï tr√¨nh duy·ªát */
    }
        form {
      position: relative; /* ƒê·ªÉ n√∫t t√¨m ki·∫øm c√≥ th·ªÉ ƒë∆∞·ª£c ƒë·ªãnh v·ªã ch√≠nh x√°c b√™n trong */
    }

    input[type="text"] {
      width: 300px; /* Ho·∫∑c k√≠ch th∆∞·ªõc ph√π h·ª£p v·ªõi giao di·ªán c·ªßa b·∫°n */
    }

    .search-button {
        border: none; /* Kh√¥ng c√≥ vi·ªÅn */
        cursor: pointer; /* Hi·ªÉn th·ªã con tr·ªè khi di chu·ªôt qua */
    }



    /* Gi·ªØ nguy√™n c√°c thu·ªôc t√≠nh v·ªã tr√≠ c·ªßa n√∫t */
    .search-button {
        position: absolute; /* ƒê·ªÉ n√∫t t√¨m ki·∫øm n·∫±m trong √¥ t√¨m ki·∫øm */
        right: 10px; /* Kho·∫£ng c√°ch t·ª´ b√™n ph·∫£i */
        transform: translateY(5%); /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
    }

}
.notification-icon {
    position: relative; /* ƒê·ªÉ ƒë·ªãnh v·ªã badge b√™n trong icon */
    display: inline-block; /* ƒê·∫£m b·∫£o n√≥ ch·ªâ chi·∫øm kh√¥ng gian c·∫ßn thi·∫øt */
    margin-right: 10px; /* Kho·∫£ng c√°ch gi·ªØa icon v√† c√°c ph·∫ßn t·ª≠ kh√°c */
}

.notification-icon .icon {
    width: px; /* K√≠ch th∆∞·ªõc c·ªßa bi·ªÉu t∆∞·ª£ng th√¥ng b√°o */
    height: 24px; /* K√≠ch th∆∞·ªõc c·ªßa bi·ªÉu t∆∞·ª£ng th√¥ng b√°o */
}

.notification-badge {
    position: absolute; /* ƒê·ªÉ ƒë·ªãnh v·ªã badge b√™n trong icon */
    top: -10px; /* ƒêi·ªÅu ch·ªânh v·ªã tr√≠ theo chi·ªÅu d·ªçc */
    right: -10px; /* ƒêi·ªÅu ch·ªânh v·ªã tr√≠ theo chi·ªÅu ngang */
    background-color: red; /* M√†u n·ªÅn n·ªïi b·∫≠t */
    color: white; /* M√†u ch·ªØ tr·∫Øng ƒë·ªÉ d·ªÖ ƒë·ªçc */
    border-radius: 50%; /* T·∫°o h√¨nh tr√≤n */
    padding: 2px 4px; /* Padding ƒë·ªÉ t·∫°o kh√¥ng gian xung quanh ch·ªØ */
    font-size: 0.75rem; /* K√≠ch th∆∞·ªõc ch·ªØ nh·ªè h∆°n */
    min-width: 20px; /* ƒê·∫£m b·∫£o c√≥ chi·ªÅu r·ªông t·ªëi thi·ªÉu */
    text-align: center; /* CƒÉn gi·ªØa ch·ªØ */
    font-weight: bold; /* Ch·ªØ ƒë·∫≠m */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* ƒê·ªï b√≥ng nh·∫π ƒë·ªÉ t·∫°o chi·ªÅu s√¢u */
}

  </style>
</head>
<body>
<header th:fragment="header">
  <nav class="bg-gray-800 p-4">
    <div class="flex justify-between items-center">
      <div class="flex items-center space-x-4">
        <a class="navbar-brand" th:href="@{/}">
          <img src="/image/logo.png" alt="Logo" style="max-height: 40px;">
        </a>
        <ul class="flex space-x-4">
          <li><a href="/" class="text-white hover:bg-gray-700 px-3 py-2 rounded">Trang ch·ªß</a></li>
          <li><a href="/about" class="text-white hover:bg-gray-700 px-3 py-2 rounded">Gi·ªõi thi·ªáu</a></li>
          <li><a href="/appointments" class="text-white hover:bg-gray-700 px-3 py-2 rounded">ƒê·∫∑t l·ªãch h·∫πn</a></li>
          <li><a href="/history" class="text-white hover:bg-gray-700 px-3 py-2 rounded">L·ªãch s·ª≠ tr·∫£ s√°ch</a></li>
        </ul>
      </div>
      <div class="flex items-center">
        <div class="relative ml-4">
          <form th:action="@{/search}" method="get" class="flex items-center">
            <input type="text" name="query" placeholder="T√¨m ki·∫øm theo t√™n s√°ch, t√°c gi·∫£, th·ªÉ lo·∫°i"  class="rounded-full pl-4 pr-10 py-2 focus:outline-none"/>
            <button type="submit" class="search-button">
              <i class="fas fa-search"></i>
            </button>
          </form>
        </div>
        <div class="relative ml-4">
          <a href="/bookshelf" class="text-white hover:bg-gray-700 px-3 py-2 rounded flex items-center">
            <img src="/image/bookshelf.png" alt="bookshelf" class="h-6 w-6"/>
          </a>
        </div>
        <div class="relative ml-4">
          <div class="flex items-center cursor-pointer" id="notificationIcon">
            <img src="/image/notification.png" alt="notification" class="h-6 w-6"/>
            <span class="notification-badge" th:if="${notificationCount > 0}" th:text="${notificationCount}">0</span>
            <span class="notification-badge" th:if="${notificationCount == 0}" style="display:none;"></span>
          </div>

          <div class="absolute right-0 mt-2 w-80 bg-white border rounded shadow-lg hidden" id="notificationDropdown">
            <h2 class="font-bold p-2">Th√¥ng B√°o</h2>
            <form th:action="@{/notifications/mark-all-read}" method="post" style="display: inline;">
            <span class="cursor-pointer text-blue-500 hover:underline px-2 py-1" style="padding: 8px; cursor: pointer;" onclick="this.closest('form').submit();">
                ƒê√°nh d·∫•u t·∫•t c·∫£ ƒë√£ ƒë·ªçc
            </span>
            </form>
            <div class="max-h-60 overflow-y-auto">
              <ul>
                <li th:each="notification : ${notifications}" class="p-2 hover:bg-gray-200">
                  <a th:href="@{/notification/{id}(id=${notification.id})}" class="block">
                    <div class="flex justify-between items-center">
                      <div>
                        <div th:text="${notification.message}"></div>
                        <div th:if="${notification.type == 'APPOINTMENT_CONFIRMATION'}">
                          <span>Ng√†y h·∫πn: </span>
                          <span th:text="${notification.getFormattedCreatedAt()}"></span>
                        </div>
                      </div>
                      <div th:if="${!notification.isRead}" class="text-red-500">Ch∆∞a ƒë·ªçc</div>
                    </div>
                    <div th:if="${notification.type == 'BOOK_BORROW'}" class="text-green-600">
                      <span>üìö S√°ch ƒë√£ m∆∞·ª£n</span>
                    </div>
                    <div th:if="${notification.type == 'APPOINTMENT_CONFIRMATION'}" class="text-blue-600">
                      <span>üìÖ L·ªãch h·∫πn ƒë√£ x√°c nh·∫≠n</span>
                    </div>
                    <div th:if="${notification.type == 'BOOK_RETURN'}" class="text-orange-600">
                      <span>üîÑ S√°ch ƒë√£ tr·∫£</span>
                    </div>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="ml-4 flex items-center relative">
          <span sec:authorize="isAuthenticated()" class="flex items-center">
            <img src="/image/user1.png" alt="User " class="h-8 w-8 rounded-full cursor-pointer" id="userImage"/>
            <span class="text-white ml-2" th:text="${#authentication.name}">T√™n ng∆∞·ªùi d√πng</span>
            <form th:action="@{/logout}" method="post" sec:authorize="isAuthenticated()" class="absolute top-full right-0 hidden mt-2" id="logoutForm">
              <button type="submit" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold px-2 py-1 rounded-full shadow-lg hover:from-blue-600 hover:to-purple-700 ml-4">
                ƒêƒÉng xu·∫•t
              </button>
            </form>
          </span>
          <a href="/login" sec:authorize="!isAuthenticated()" class="bg-blue-800 text-white border border-white px-2 py-1 rounded hover:bg-red-700">
            ƒêƒÉng nh·∫≠p
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>

<main th:fragment="content">
  <div class="container mx-auto mt-4">
    <p>Replaceable content goes here</p>
  </div>
</main>

<footer th:fragment="footer" class="bg-gray-800 text-white py-4">
  <div class="container mx-auto text-center">
    <span>¬© 2024 Qu·∫£n l√Ω Th∆∞ Vi·ªán.</span>
  </div>
</footer>
<script>

  const userImage = document.getElementById('userImage');
  const logoutForm = document.getElementById('logoutForm');

  userImage.addEventListener('click', function() {
    // Toggle hi·ªÉn th·ªã n√∫t ƒëƒÉng xu·∫•t
    if (logoutForm.classList.contains('hidden')) {
      logoutForm.classList.remove('hidden');
    } else {
      logoutForm.classList.add('hidden');
    }
  });

  // ƒê√≥ng n√∫t ƒëƒÉng xu·∫•t khi nh·∫•p b√™n ngo√†i
  document.addEventListener('click', function(event) {
    if (!userImage.contains(event.target) && !logoutForm.contains(event.target)) {
      logoutForm.classList.add('hidden');
    }
  });

const notificationIcon = document.getElementById('notificationIcon');
const notificationDropdown = document.getElementById('notificationDropdown');

notificationIcon.addEventListener('click', function(event) {
    event.stopPropagation(); // NgƒÉn ch·∫∑n s·ª± ki·ªán click t·ª´ lan ra ngo√†i
    notificationDropdown.classList.toggle('hidden'); // Chuy·ªÉn ƒë·ªïi l·ªõp 'hidden' ƒë·ªÉ hi·ªÉn th·ªã ho·∫∑c ·∫©n dropdown
});

// ƒê√≥ng dropdown khi nh·∫•p b√™n ngo√†i
document.addEventListener('click', function(event) {
    if (!notificationIcon.contains(event.target) && !notificationDropdown.contains(event.target)) {
        notificationDropdown.classList.add('hidden');
    }
});


</script>

</script>
</body>
</html>